!function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.l=!0,module.exports}__webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.d=function(exports,name,getter){__webpack_require__.o(exports,name)||Object.defineProperty(exports,name,{enumerable:!0,get:getter})},__webpack_require__.r=function(exports){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(exports,"__esModule",{value:!0})},__webpack_require__.t=function(value,mode){if(1&mode&&(value=__webpack_require__(value)),8&mode)return value;if(4&mode&&"object"==typeof value&&value&&value.__esModule)return value;var ns=Object.create(null);if(__webpack_require__.r(ns),Object.defineProperty(ns,"default",{enumerable:!0,value:value}),2&mode&&"string"!=typeof value)for(var key in value)__webpack_require__.d(ns,key,(function(key){return value[key]}).bind(null,key));return ns},__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,"a",getter),getter},__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s="g+af")}({"g+af":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);class Point{constructor(x,y){this.x=x,this.y=y}distance(other){let dx=other.x-this.x,dy=other.y-this.y;return Math.sqrt(dx*dx+dy*dy)}toString(){return"("+this.x+","+this.y+")"}}function findIntersectionAtY(y,p1,p2){if(p1.y==p2.y)return NaN;let pt1=p1,pt2=p2;return p1.y>p2.y&&(pt2=p1,pt1=p2),y<pt1.y?NaN:y>pt2.y?NaN:pt1.x+(y-pt1.y)/(pt2.y-pt1.y)*(pt2.x-pt1.x)}class segment_Segment{constructor(p1,p2){this.p1=p1,this.p2=p2}minY(){return Math.min(this.p1.y,this.p2.y)}maxY(){return Math.max(this.p1.y,this.p2.y)}toString(){return"["+this.p1.toString()+","+this.p2.toString()+"]"}getCenter(){return new Point((this.p1.x+this.p2.x)/2,(this.p1.y+this.p2.y)/2)}}class quad_Quad{constructor(p1,p2,p3,p4){this.p1=p1,this.p2=p2,this.p3=p3,this.p4=p4}segments(){return[new segment_Segment(this.p1,this.p2),new segment_Segment(this.p2,this.p3),new segment_Segment(this.p3,this.p4),new segment_Segment(this.p4,this.p1)]}area(){function triArea(side1length,side2length,side3length){var p=(side1length+side2length+side3length)/2;return Math.sqrt(p*(p-side1length)*(p-side2length)*(p-side3length))}let s1Length=this.p1.distance(this.p2),s2Length=this.p2.distance(this.p3),bisectLength=this.p1.distance(this.p3),s3Length=this.p3.distance(this.p4),s4Length=this.p4.distance(this.p1);return triArea(s1Length,s2Length,bisectLength)+triArea(s3Length,s4Length,bisectLength)}scale(sx,sy){return new quad_Quad(new Point(this.p1.x*sx,this.p1.y*sy),new Point(this.p2.x*sx,this.p2.y*sy),new Point(this.p3.x*sx,this.p3.y*sy),new Point(this.p4.x*sx,this.p4.y*sy))}minY(){return Math.min(this.p1.y,Math.min(this.p2.y,Math.min(this.p3.y,this.p4.y)))}maxY(){return Math.max(this.p1.y,Math.max(this.p2.y,Math.max(this.p3.y,this.p4.y)))}xSpan(y){let xIntersections=[],intersection=findIntersectionAtY(y,this.p1,this.p2);return Number.isNaN(intersection)||xIntersections.push(intersection),intersection=findIntersectionAtY(y,this.p2,this.p3),Number.isNaN(intersection)||xIntersections.push(intersection),intersection=findIntersectionAtY(y,this.p3,this.p4),Number.isNaN(intersection)||xIntersections.push(intersection),intersection=findIntersectionAtY(y,this.p4,this.p1),Number.isNaN(intersection)||xIntersections.push(intersection),xIntersections.length<1?[]:xIntersections.length<2?[xIntersections[0],xIntersections[0]]:xIntersections[0]<xIntersections[1]?[xIntersections[0],xIntersections[1]]:[xIntersections[1],xIntersections[0]]}toString(){return"["+this.p1.toString()+","+this.p2.toString()+","+this.p3.toString()+","+this.p4.toString()+"]"}getCenter(){return new Point((this.p1.x+this.p2.x+this.p3.x+this.p4.x)/4,(this.p1.y+this.p2.y+this.p3.y+this.p4.y)/4)}}class voronoi_worker_Voronoi{constructor(width,height,margin){this.width=width,this.height=height,this.margin=margin,this.edges=[],this.top=0,this.left=0,this.edgeUpdateThreshold=3773,this.pymin=0,this.pymax=0,this.pxmin=0,this.pxmax=0,this.pymin=margin,this.pymax=height-margin,this.pxmin=margin,this.pxmax=width-margin}computeVoronoi(points){this.edgeUpdateThreshold=1373;let newIntStar,lbnd,rbnd,llbnd,rrbnd,bisector,bot,top,sites=new Sites(points),geom=new voronoi_worker_Geom(this),edgeList=new EdgeList(sites,geom),events=new voronoi_worker_EventQueue,newSite=sites.list.shift();var temp,p,v;let pm,e;for(;;)if(events.empty()||(newIntStar=events.min()),newSite&&(events.empty()||newSite.y<newIntStar.y||newSite.y==newIntStar.y&&newSite.x<newIntStar.x))lbnd=edgeList.leftBound(newSite),rbnd=edgeList.right(lbnd),bot=edgeList.rightRegion(lbnd),e=geom.bisect(bot,newSite),bisector=edgeList.createHalfEdge(e,"left"),edgeList.insert(lbnd,bisector),(p=geom.intersect(lbnd,bisector))&&(events.del(lbnd),events.insert(lbnd,p,geom.distance(p,newSite))),lbnd=bisector,bisector=edgeList.createHalfEdge(e,"right"),edgeList.insert(lbnd,bisector),(p=geom.intersect(bisector,rbnd))&&events.insert(bisector,p,geom.distance(p,newSite)),newSite=sites.list.shift();else{if(events.empty())break;lbnd=events.extractMin(),llbnd=edgeList.left(lbnd),rbnd=edgeList.right(lbnd),rrbnd=edgeList.right(rbnd),bot=edgeList.leftRegion(lbnd),top=edgeList.rightRegion(rbnd),geom.endPoint(lbnd.edge,lbnd.side,v=lbnd.vertex),geom.endPoint(rbnd.edge,rbnd.side,v),edgeList.del(lbnd),events.del(rbnd),edgeList.del(rbnd),pm="left",bot.y>top.y&&(temp=bot,bot=top,top=temp,pm="right"),e=geom.bisect(bot,top),bisector=edgeList.createHalfEdge(e,pm),edgeList.insert(llbnd,bisector),geom.endPoint(e,"left"==pm?"right":"left",v),(p=geom.intersect(llbnd,bisector))&&(events.del(llbnd),events.insert(llbnd,p,geom.distance(p,bot))),(p=geom.intersect(bisector,rrbnd))&&events.insert(bisector,p,geom.distance(p,bot))}for(lbnd=edgeList.right(edgeList.leftEnd);lbnd!=edgeList.rightEnd;lbnd=edgeList.right(lbnd))this.clipLine(e=lbnd.edge)}clipLine(e){let s1,s2,x1,x2,y1,y2;if(1==e.a&&e.b>=0?(s1=e.ep.right,s2=e.ep.left):(s1=e.ep.left,s2=e.ep.right),1==e.a){if(y1=this.pymin,s1&&s1.y>this.pymin&&(y1=s1.y),y1>this.pymax)return;if(y2=this.pymax,s2&&s2.y<this.pymax&&(y2=s2.y),y2<this.pymin)return;if(x2=e.c-e.b*y2,(x1=e.c-e.b*y1)>this.pxmax&&x2>this.pxmax||x1<this.pxmin&&x2<this.pxmin)return;x1>this.pxmax&&(y1=(e.c-(x1=this.pxmax))/e.b),x1<this.pxmin&&(y1=(e.c-(x1=this.pxmin))/e.b),x2>this.pxmax&&(y2=(e.c-(x2=this.pxmax))/e.b),x2<this.pxmin&&(y2=(e.c-(x2=this.pxmin))/e.b)}else{if(x1=this.pxmin,s1&&s1.x>this.pxmin&&(x1=s1.x),x1>this.pxmax)return;if(x2=this.pxmax,s2&&s2.x<this.pxmax&&(x2=s2.x),x2<this.pxmin)return;if(y2=e.c-e.a*x2,(y1=e.c-e.a*x1)>this.pymax&&y2>this.pymax||y1<this.pymin&&y2<this.pymin)return;y1>this.pymax&&(x1=(e.c-(y1=this.pymax))/e.a),y1<this.pymin&&(x1=(e.c-(y1=this.pymin))/e.a),y2>this.pymax&&(x2=(e.c-(y2=this.pymax))/e.a),y2<this.pymin&&(x2=(e.c-(y2=this.pymin))/e.a)}this.edges.push(new segment_Segment(new Point(x1,y1),new Point(x2,y2))),this.edges.length%this.edgeUpdateThreshold==1&&(postMessage({message:"status",stage:"Generating Voronoi Cels",count:this.edges.length},[]),this.edgeUpdateThreshold=Math.floor(1.05*this.edgeUpdateThreshold))}}class Sites{constructor(list){this.list=list,this.sort(),this.bottomSite=list.shift()}sort(){this.list.sort((function(a,b){return a.y<b.y?-1:a.y>b.y?1:a.x<b.x?-1:a.x>b.x?1:0}))}}class Edge{constructor(){this.a=0,this.b=0,this.c=0,this.region=null,this.ep=null,this.edge=null,this.side="",this.vertex=null,this.left=null,this.right=null,this.ystar=0}}class EdgeList{constructor(sites,geom){this.sites=sites,this.geom=geom,this.list=[],this.leftEnd=null,this.rightEnd=null,this.leftEnd=this.createHalfEdge(null,"left"),this.rightEnd=this.createHalfEdge(null,"left"),this.leftEnd.right=this.rightEnd,this.rightEnd.left=this.leftEnd,this.list.unshift(this.leftEnd,this.rightEnd)}createHalfEdge(edge,side){let e=new Edge;return e.edge=edge,e.side=side,e}insert(lb,he){he.left=lb,he.right=lb.right,lb.right.left=he,lb.right=he}leftBound(p){let he=this.leftEnd;do{he=he.right}while(he!=this.rightEnd&&this.geom.rightOf(he,p));return he.left}del(he){he.left.right=he.right,he.right.left=he.left,he.edge=null}right(he){return he.right}left(he){return he.left}leftRegion(he){return null==he.edge?this.sites.bottomSite:"left"==he.side?he.edge.region.left:he.edge.region.right}rightRegion(he){return null==he.edge?this.sites.bottomSite:"left"==he.side?he.edge.region.right:he.edge.region.left}}class Span{constructor(left,right){this.left=left,this.right=right}Get(which){return"left"==which?this.left:this.right}Set(which,value){"left"==which?this.left=value:this.right=value}}class voronoi_worker_Geom{constructor(target){this.target=target}bisect(s1,s2){let newEdge=new Edge;newEdge.region=new Span(s1,s2),newEdge.ep=new Span(null,null);let dx=s2.x-s1.x,dy=s2.y-s1.y,adx=dx>0?dx:-dx,ady=dy>0?dy:-dy;return newEdge.c=s1.x*dx+s1.y*dy+.5*(dx*dx+dy*dy),adx>ady?(newEdge.a=1,newEdge.b=dy/dx,newEdge.c/=dx):(newEdge.b=1,newEdge.a=dx/dy,newEdge.c/=dy),newEdge}intersect(el1,el2){var e1=el1.edge,e2=el2.edge;if(!e1||!e2)return null;if(e1.region.right==e2.region.right)return null;var d=e1.a*e2.b-e1.b*e2.a;if(Math.abs(d)<1e-10)return null;let el,e,xint=(e1.c*e2.b-e2.c*e1.b)/d,e1r=e1.region.right,e2r=e2.region.right;e1r.y<e2r.y||e1r.y==e2r.y&&e1r.x<e2r.x?(el=el1,e=e1):(el=el2,e=e2);var rightOfSite=xint>=e.region.right.x;return rightOfSite&&"left"==el.side||!rightOfSite&&"right"==el.side?null:new Point(xint,(e2.c*e1.a-e1.c*e2.a)/d)}rightOf(he,p){var e=he.edge,topsite=e.region.right,rightOfSite=p.x>topsite.x;if(rightOfSite&&"left"==he.side)return!0;if(!rightOfSite&&"right"==he.side)return!1;let above=!1;if(1==e.a){let dyp=p.y-topsite.y,dxp=p.x-topsite.x,fast=!1;if(!rightOfSite&&e.b<0||rightOfSite&&e.b>=0?above=fast=dyp>=e.b*dxp:(above=p.x+p.y*e.b>e.c,e.b<0&&(above=!above),above||(fast=!0)),!fast){var dxs=topsite.x-e.region.left.x;above=e.b*(dxp*dxp-dyp*dyp)<dxs*dyp*(1+2*dxp/dxs+e.b*e.b),e.b<0&&(above=!above)}}else{var yl=e.c-e.a*p.x,t1=p.y-yl,t2=p.x-topsite.x,t3=yl-topsite.y;above=t1*t1>t2*t2+t3*t3}return"left"==he.side?above:!above}endPoint(edge,side,site){edge.ep.Set(side,site),edge.ep.Get("left"==side?"right":"left")&&this.target.clipLine(edge)}distance(s,t){var dx=s.x-t.x,dy=s.y-t.y;return Math.sqrt(dx*dx+dy*dy)}}class voronoi_worker_EventQueue{constructor(){this.list=[]}insert(he,site,offset){he.vertex=site,he.ystar=site.y+offset;for(var i=0,list=this.list,l=list.length;i<l;i++){var next=list[i];if(!(he.ystar>next.ystar||he.ystar==next.ystar&&site.x>next.vertex.x))break}list.splice(i,0,he)}del(he){for(var i=0,ls=this.list,l=ls.length;i<l&&ls[i]!=he;++i);ls.splice(i,1)}empty(){return 0==this.list.length}nextEvent(he){for(var i=0,ls=this.list,l=ls.length;i<l;++i)if(ls[i]==he)return ls[i+1];return null}min(){var elem=this.list[0];return new Point(elem.vertex.x,elem.ystar)}extractMin(){return this.list.shift()}}class Sampler{constructor(greyscale,sourcewidth,sourceheight,targetwidth,targetheight,invert){this.greyscale=greyscale,this.sourcewidth=sourcewidth,this.sourceheight=sourceheight,this.targetwidth=targetwidth,this.targetheight=targetheight,this.invert=invert,this.scaleX=1,this.scaleY=1,this.scaleX=this.sourcewidth/this.targetwidth,this.scaleY=this.sourceheight/this.targetheight}sampleQuad(targetQuad){let sourceQuad=targetQuad.scale(this.scaleX,this.scaleY),minY=sourceQuad.minY(),maxY=sourceQuad.maxY(),total=0,count=0;for(let y=minY;y<=maxY;y++){let xSpan=sourceQuad.xSpan(y),yRow=Math.floor(y),xCol=Math.floor(xSpan[0]);if(1==xSpan.length)total+=this.greyscale[yRow*this.sourcewidth+xCol],count++;else if(2==xSpan.length){let length=xSpan[1]-xSpan[0];length<1&&(length=1);let index=yRow*this.sourcewidth+xCol;for(;length>0;)total+=this.greyscale[index++],count++,length--}else console.log("huh?")}if(0==count)return 1;let result=total/count;return this.invert?255-result:result}}let splinterWorker=new class{constructor(){this.quads=[],this.splinterEdges=[],this.voronoiEdges=[],this.points=[],this.slantAmount=.2,this.minQuadArea=30,this.sampler=null,this.cellScale=0,this.lastEdgeUpdate=0,this.edgeUpdateThreshold=13737,this.settings=null}setup(settings,sampler){this.settings=settings,this.sampler=sampler,this.minQuadArea=settings.minCellSize,this.cellScale=settings.cellScale,this.quads=[],this.points=[],this.voronoiEdges=[],this.lastEdgeUpdate=0;let startQuad=new quad_Quad(new Point(settings.margin,settings.margin),new Point(settings.targetwidth-settings.margin,settings.margin),new Point(settings.targetwidth-settings.margin,settings.targetheight-settings.margin),new Point(settings.margin,settings.targetheight-settings.margin));this.quads.push(startQuad);let startingEdges=startQuad.segments();this.splinterEdges=startingEdges}updateSettings(settings){this.settings=settings}findSplit(p1,p2,t){return new Point(p1.x+t*(p2.x-p1.x),p1.y+t*(p2.y-p1.y))}splitQuad(q){let area=q.area();if(area<this.minQuadArea)return[q];let value=this.sampler.sampleQuad(q);if(area/this.cellScale<value*value*value/5e4)return[q];let t1=Math.random()*this.slantAmount+(1-this.slantAmount)/2,t2=Math.random()*this.slantAmount+(1-this.slantAmount)/2;if(q.p1.distance(q.p2)+q.p3.distance(q.p4)<q.p2.distance(q.p3)+q.p4.distance(q.p1)){let splitPoint1=this.findSplit(q.p2,q.p3,t1),splitPoint2=this.findSplit(q.p4,q.p1,t2);return this.splinterEdges.push(new segment_Segment(splitPoint1,splitPoint2)),[new quad_Quad(q.p1,q.p2,splitPoint1,splitPoint2),new quad_Quad(splitPoint2,splitPoint1,q.p3,q.p4)]}{let splitPoint1=this.findSplit(q.p1,q.p2,t1),splitPoint2=this.findSplit(q.p3,q.p4,t2);return this.splinterEdges.push(new segment_Segment(splitPoint1,splitPoint2)),[new quad_Quad(q.p1,splitPoint1,splitPoint2,q.p4),new quad_Quad(splitPoint1,q.p2,q.p3,splitPoint2)]}}doOneSplitPass(){let oldQuads=this.quads;return this.quads=[],oldQuads.forEach((function(q){let newQuads=this.splitQuad(q);this.quads.push(newQuads[0]),newQuads.length>1&&this.quads.push(newQuads[1]),this.splinterEdges.length-this.lastEdgeUpdate>this.edgeUpdateThreshold&&this.sendSplinterUpdate()}).bind(this)),oldQuads.length!=this.quads.length}splinter(){for(var i=0;i<24&&this.doOneSplitPass();i++);}fillCanvas(ctx,width,height,color){ctx.fillStyle=color,ctx.fillRect(0,0,width,height)}renderSplinter(){let bitmap=this.renderEdges(this.splinterEdges).transferToImageBitmap();postMessage({message:"splinterImageRendered",image:bitmap},[bitmap])}computeCenterPoints(){postMessage({message:"status",stage:"Computing Center Points",count:0}),0==this.points.length&&this.quads.forEach((function(q){this.points.push(q.getCenter())}).bind(this))}computeVoronoi(){if(0==this.quads.length&&this.splinter(),0==this.voronoiEdges.length){this.computeCenterPoints(),postMessage({message:"status",stage:"Computing Voronoi",count:0});let voronoi=new voronoi_worker_Voronoi(this.settings.targetwidth,this.settings.targetheight,this.settings.margin);voronoi.computeVoronoi(this.points),this.voronoiEdges=voronoi.edges,postMessage({message:"status",stage:"Voronoi Done",count:0})}}renderVoronoi(){this.computeVoronoi();let canvas=this.renderEdges(this.voronoiEdges),context=canvas.getContext("2d");context.beginPath(),context.moveTo(this.settings.margin,this.settings.margin),context.lineTo(this.settings.targetwidth-this.settings.margin,this.settings.margin),context.lineTo(this.settings.targetwidth-this.settings.margin,this.settings.targetheight-this.settings.margin),context.lineTo(this.settings.margin,this.settings.targetheight-this.settings.margin),context.lineTo(this.settings.margin,this.settings.margin),context.stroke();let bitmap=canvas.transferToImageBitmap();postMessage({message:"voronoiImageRendered",image:bitmap},[bitmap])}renderEdges(renderEdges){let canvas=new OffscreenCanvas(this.settings.targetwidth,this.settings.targetheight),context=canvas.getContext("2d");context.lineWidth=this.settings.lineThickness,context.strokeStyle=this.settings.foregroundColor,this.fillCanvas(context,this.settings.targetwidth,this.settings.targetheight,this.settings.backgroundColor);let lastRenderingUpdate=0;for(var i=0;i<renderEdges.length;i++){let seg=renderEdges[i];context.beginPath(),context.moveTo(seg.p1.x,seg.p1.y),context.lineTo(seg.p2.x,seg.p2.y),context.stroke(),i-lastRenderingUpdate>this.edgeUpdateThreshold&&(postMessage({message:"status",stage:"Rendering Edges",count:i}),lastRenderingUpdate=i)}return canvas}updateRenderSplinter(settings){this.settings=settings,this.renderSplinter()}updateRenderVoronoi(settings){this.settings=settings,this.renderVoronoi()}splinterAndRender(){this.splinter(),this.renderSplinter()}sendSplinterUpdate(){this.lastEdgeUpdate=this.splinterEdges.length,postMessage({message:"status",stage:"Splintering",count:this.splinterEdges.length})}},webworker_worker_sampler=null,lastRenderedSettings=new class{constructor(sourcewidth,sourceheight,targetwidth,targetheight,margin,lineThickness,cellScale,minCellSize,invertSampling,foregroundColor,backgroundColor,voronoiChecked){this.sourcewidth=sourcewidth,this.sourceheight=sourceheight,this.targetwidth=targetwidth,this.targetheight=targetheight,this.margin=margin,this.lineThickness=lineThickness,this.cellScale=cellScale,this.minCellSize=minCellSize,this.invertSampling=invertSampling,this.foregroundColor=foregroundColor,this.backgroundColor=backgroundColor,this.voronoiChecked=voronoiChecked}}(0,0,0,0,0,0,0,0,!1,"","",!1);addEventListener("message",({data:data})=>{switch(data.message){case"makeItSo":{let settings=data.settings,mustRedoSplinter=data.newImage;settings.targetwidth==lastRenderedSettings.targetwidth&&settings.targetheight==lastRenderedSettings.targetheight&&settings.invertSampling==lastRenderedSettings.invertSampling&&settings.cellScale==lastRenderedSettings.cellScale&&settings.minCellSize==lastRenderedSettings.minCellSize||(mustRedoSplinter=!0),lastRenderedSettings=settings,mustRedoSplinter?(webworker_worker_sampler=new Sampler(data.greyScaleSamples,settings.sourcewidth,settings.sourceheight,settings.targetwidth,settings.targetheight,settings.invertSampling),splinterWorker.setup(settings,webworker_worker_sampler),splinterWorker.splinter()):splinterWorker.updateSettings(settings),0==settings.voronoiChecked?splinterWorker.renderSplinter():splinterWorker.renderVoronoi()}break;default:console.log(`Web worker got unknown message ${data}`),postMessage(`worker response to ${data}`)}})}});